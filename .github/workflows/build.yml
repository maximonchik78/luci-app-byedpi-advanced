name: Basic Checks

on: [push, pull_request]

jobs:
  lint:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Check file structure
      run: |
        echo "Checking required files..."
        [ -f "Makefile" ] || echo "⚠ Missing: Makefile"
        [ -f "install.sh" ] || echo "⚠ Missing: install.sh"
        [ -f "README.md" ] || echo "⚠ Missing: README.md"
        [ -d "luasrc" ] || echo "⚠ Missing: luasrc directory"
        [ -d "files" ] || echo "⚠ Missing: files directory"
        
        # Проверяем наличие критических файлов
        REQUIRED_FILES=(
          "files/etc/init.d/byedpi"
          "luasrc/controller/byedpi.lua"
          "luasrc/model/cbi/byedpi.lua"
        )
        
        for file in "${REQUIRED_FILES[@]}"; do
          if [ -f "$file" ]; then
            echo "✓ $file"
          else
            echo "✗ Missing: $file"
            exit 1
          fi
        done
    
    - name: Check Lua syntax
      run: |
        if command -v lua5.3 &> /dev/null; then
          echo "Checking Lua files..."
          find . -name "*.lua" -type f -exec lua5.3 -l {} \;
        else
          echo "Lua not installed, skipping syntax check"
        fi
    
    - name: Check shell scripts
      run: |
        if command -v shellcheck &> /dev/null; then
          echo "Checking shell scripts with shellcheck..."
          find . -name "*.sh" -type f -exec shellcheck {} \;
        else
          echo "shellcheck not installed, skipping"
        fi
    
    - name: Verify install script
      run: |
        echo "Verifying install script..."
        bash -n install.sh && echo "✓ install.sh syntax OK" || exit 1
        bash -n uninstall.sh && echo "✓ uninstall.sh syntax OK" || exit 1
